<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Headquartz.Pages.Warehouse.WarehouseDashboardPage"
             Title="WarehouseDashboardPage">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Header Section -->
            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                <VerticalStackLayout Grid.Column="0" Spacing="4">
                    <Label Text="Warehouse Management"
                           Style="{StaticResource PageTitleStyle}"/>
                    <Label Text="Monitor inventory, track movements, and manage stock levels"
                           Style="{StaticResource PageSubtitleStyle}"/>
                </VerticalStackLayout>

                <Border Grid.Column="1"
                        Style="{StaticResource CardStyle}"
                        Padding="16,8"
                        BackgroundColor="{StaticResource Primary}">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="ðŸ“Š" FontSize="20" VerticalOptions="Center"/>
                        <VerticalStackLayout Spacing="0">
                            <Label Text="Accuracy"
                                   FontSize="11"
                                   TextColor="White"
                                   Opacity="0.9"/>
                            <Label Text="{Binding Metrics.InventoryAccuracy, StringFormat='{0:F1}%'}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Border>
            </Grid>

            <!-- Key Metrics Cards -->
            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="12">

                <!-- Stock Items -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="8" Padding="16">
                        <Label Text="ðŸ“¦" FontSize="24"/>
                        <Label Text="Stock Items"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                        <Label Text="{Binding TotalStockItems}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource DarkOnLightBackground}, Dark={StaticResource LightOnDarkBackground}}"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Space Utilization -->
                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="8" Padding="16">
                        <Label Text="ðŸ“" FontSize="24"/>
                        <Label Text="Space Used"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                        <Label Text="{Binding Metrics.SpaceUtilization, StringFormat='{0:F1}%'}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource DarkOnLightBackground}, Dark={StaticResource LightOnDarkBackground}}"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Active Alerts -->
                <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="8" Padding="16">
                        <Label Text="âš ï¸" FontSize="24"/>
                        <Label Text="Active Alerts"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                        <Label Text="{Binding Metrics.ActiveAlerts}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Warning}"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Transactions Today -->
                <Border Grid.Column="3" Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="8" Padding="16">
                        <Label Text="ðŸ”„" FontSize="24"/>
                        <Label Text="Transactions"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                        <Label Text="{Binding TodayTransactions}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource DarkOnLightBackground}, Dark={StaticResource LightOnDarkBackground}}"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Quick Actions -->
            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12" Padding="20">
                    <Label Text="Quick Actions"
                           FontSize="16"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="ðŸ“¥ Receive Goods"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding ReceiveGoodsCommand}"/>

                        <Button Grid.Column="1"
                                Text="ðŸ“¤ Issue Stock"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding IssueStockCommand}"/>

                        <Button Grid.Column="2"
                                Text="ðŸ”„ Transfer Stock"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding TransferStockCommand}"/>
                    </Grid>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="ðŸ” Cycle Count"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding CycleCountCommand}"/>

                        <Button Grid.Column="1"
                                Text="ðŸ“‹ View Transactions"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ViewTransactionsCommand}"/>

                        <Button Grid.Column="2"
                                Text="âš ï¸ View Alerts"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ViewAlertsCommand}"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Stock Alerts Section -->
            <Border Style="{StaticResource CardStyle}" IsVisible="{Binding HasAlerts}">
                <VerticalStackLayout Spacing="12" Padding="20">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="âš ï¸" FontSize="20"/>
                        <Label Text="Stock Alerts"
                               FontSize="16"
                               FontAttributes="Bold"
                               VerticalOptions="Center"/>
                        <Label Text="{Binding Alerts.Count, StringFormat='({0})'}"
                               FontSize="14"
                               TextColor="{StaticResource Warning}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <CollectionView ItemsSource="{Binding Alerts}" MaximumHeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource CardStyle}"
                                        Padding="12"
                                        Margin="0,4"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource Gray50}, Dark={StaticResource DarkBackground}}">
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                        <Label Grid.Column="0"
                                               Text="{Binding Type, Converter={StaticResource AlertIconConverter}}"
                                               FontSize="20"
                                               VerticalOptions="Center"/>

                                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                                            <Label Text="{Binding ProductName}"
                                                   FontSize="14"
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Message}"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                                        </VerticalStackLayout>

                                        <Label Grid.Column="2"
                                               Text="{Binding Priority}"
                                               FontSize="10"
                                               TextColor="{Binding Priority, Converter={StaticResource PriorityColorConverter}}"
                                               BackgroundColor="{Binding Priority, Converter={StaticResource PriorityBackgroundConverter}}"
                                               Padding="8,4"
                                               VerticalOptions="Center">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ResolveAlertCommand}"
                                                                    CommandParameter="{Binding .}"/>
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <!-- Current Stock Overview -->
            <Border Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="12" Padding="20">
                    <HorizontalStackLayout Spacing="8" HorizontalOptions="FillAndExpand">
                        <Label Text="Current Inventory"
                               FontSize="16"
                               FontAttributes="Bold"
                               HorizontalOptions="StartAndExpand"/>

                        <SearchBar Placeholder="Search products..."
                                   WidthRequest="300"
                                   Text="{Binding SearchText}"
                                   HorizontalOptions="End"/>
                    </HorizontalStackLayout>

                    <!-- Inventory List -->
                    <CollectionView ItemsSource="{Binding FilteredInventory}"
                                    MaximumHeightRequest="400">
                        <CollectionView.Header>
                            <Grid ColumnDefinitions="2*,*,*,*,*" 
                                  Padding="12,8"
                                  BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource DarkBackground}}">
                                <Label Grid.Column="0" Text="Product" FontAttributes="Bold" FontSize="12"/>
                                <Label Grid.Column="1" Text="On Hand" FontAttributes="Bold" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Grid.Column="2" Text="Reorder Point" FontAttributes="Bold" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Grid.Column="3" Text="Status" FontAttributes="Bold" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Grid.Column="4" Text="Actions" FontAttributes="Bold" FontSize="12" HorizontalTextAlignment="Center"/>
                            </Grid>
                        </CollectionView.Header>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="2*,*,*,*,*" 
                                      Padding="12,10"
                                      BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource DarkSecondaryBackground}}">

                                    <VerticalStackLayout Grid.Column="0" Spacing="2">
                                        <Label Text="{Binding ProductName}" FontSize="14" FontAttributes="Bold"/>
                                        <Label Text="{Binding SKU}" FontSize="11" TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource SecondaryDarkText}}"/>
                                    </VerticalStackLayout>

                                    <Label Grid.Column="1" 
                                           Text="{Binding QuantityOnHand}" 
                                           FontSize="14"
                                           HorizontalTextAlignment="Center"
                                           VerticalTextAlignment="Center"/>

                                    <Label Grid.Column="2" 
                                           Text="{Binding ReorderPoint}" 
                                           FontSize="14"
                                           HorizontalTextAlignment="Center"
                                           VerticalTextAlignment="Center"/>

                                    <Label Grid.Column="3"
                                           Text="{Binding Condition}"
                                           FontSize="11"
                                           Padding="6,3"
                                           HorizontalTextAlignment="Center"
                                           VerticalTextAlignment="Center"
                                           BackgroundColor="{Binding Condition, Converter={StaticResource ConditionColorConverter}}"/>

                                    <HorizontalStackLayout Grid.Column="4" 
                                                          Spacing="8" 
                                                          HorizontalOptions="Center">
                                        <Label Text="âœï¸" FontSize="16">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditItemCommand}"
                                                                    CommandParameter="{Binding .}"/>
                                            </Label.GestureRecognizers>
                                        </Label>
                                        <Label Text="ðŸ“Š" FontSize="16">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ViewDetailsCommand}"
                                                                    CommandParameter="{Binding .}"/>
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </HorizontalStackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>