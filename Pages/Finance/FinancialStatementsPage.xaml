<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Headquartz.Pages.Finance.FinancialStatementsPage"
             Title="FinancialStatementsPage">
    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Statements Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource HeaderBackgroundColor}"
                Padding="20,15">
            <VerticalStackLayout Spacing="15">
                <HorizontalStackLayout>
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Financial Statements" 
                               FontSize="24" 
                               FontAttributes="Bold"
                               TextColor="{DynamicResource PrimaryTextColor}"/>
                        <Label Text="Generate P and L, balance sheets, and audit reports" 
                               FontSize="14"
                               TextColor="{DynamicResource SecondaryTextColor}"/>
                    </VerticalStackLayout>

                    <Border Background="{DynamicResource PrimaryColor}"
                            Padding="15,10"
                            StrokeShape="RoundRectangle 10"
                            Margin="20,0,0,0">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="ðŸ“„" FontSize="18"/>
                            <Label Text="{Binding StatementCount, StringFormat='{0} Statements'}" 
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                        </HorizontalStackLayout>
                    </Border>
                </HorizontalStackLayout>

                <!-- Statement Type Tabs -->
                <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center">
                    <Button Text="ðŸ“Š Profit and Loss" 
                            BackgroundColor="{Binding IsPLTabActive, Converter={StaticResource TabActiveConverter}}"
                            TextColor="{Binding IsPLTabActive, Converter={StaticResource TabTextColorConverter}}"
                            CornerRadius="20"
                            Padding="20,10"
                            Margin="0,0,10,0"
                            Command="{Binding SwitchToPLCommand}"/>

                    <Button Text="âš–ï¸ Balance Sheet" 
                            BackgroundColor="{Binding IsBalanceSheetTabActive, Converter={StaticResource TabActiveConverter}}"
                            TextColor="{Binding IsBalanceSheetTabActive, Converter={StaticResource TabTextColorConverter}}"
                            CornerRadius="20"
                            Padding="20,10"
                            Margin="0,0,10,0"
                            Command="{Binding SwitchToBalanceSheetCommand}"/>

                    <Button Text="ðŸ’µ Cash Flow" 
                            BackgroundColor="{Binding IsCashFlowTabActive, Converter={StaticResource TabActiveConverter}}"
                            TextColor="{Binding IsCashFlowTabActive, Converter={StaticResource TabTextColorConverter}}"
                            CornerRadius="20"
                            Padding="20,10"
                            Margin="0,0,10,0"
                            Command="{Binding SwitchToCashFlowCommand}"/>

                    <Button Text="ðŸ‘ï¸ Audit Reports" 
                            BackgroundColor="{Binding IsAuditTabActive, Converter={StaticResource TabActiveConverter}}"
                            TextColor="{Binding IsAuditTabActive, Converter={StaticResource TabTextColorConverter}}"
                            CornerRadius="20"
                            Padding="20,10"
                            Command="{Binding SwitchToAuditCommand}"/>
                </FlexLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Statements Content -->
        <ScrollView Grid.Row="1" Padding="20">
            <VerticalStackLayout Spacing="20">

                <!-- Profit & Loss Statement -->
                <Border Background="{DynamicResource CardBackgroundColor}"
                        Padding="20"
                        StrokeShape="RoundRectangle 10"
                        IsVisible="{Binding ShowPL}">
                    <VerticalStackLayout Spacing="15">
                        <HorizontalStackLayout>
                            <Label Text="Profit and Loss Statement" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                            <Label Text="{Binding PLPeriod, StringFormat='{0}'}" 
                                   BackgroundColor="{DynamicResource PrimaryColor}"
                                   TextColor="White"
                                   Padding="10,5"
                                   Margin="10,0,0,0"/>

                        </HorizontalStackLayout>

                        <!-- Revenue Section -->
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Revenue" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource SuccessColor}"/>

                            <CollectionView ItemsSource="{Binding PLRevenues}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10,8" 
                                                Margin="0,0,0,2"
                                                Background="{DynamicResource HeaderBackgroundColor}">
                                            <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                                <Label Grid.Column="0" 
                                                       Text="{Binding Description}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource PrimaryTextColor}"/>
                                                <Label Grid.Column="1" 
                                                       Text="{Binding Amount, StringFormat='${0:N0}'}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource SuccessColor}"
                                                       HorizontalOptions="End"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- Total Revenue -->
                            <Border Padding="15,10" 
                                    Background="{DynamicResource HeaderBackgroundColor}">
                                <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                    <Label Grid.Column="0" 
                                           Text="Total Revenue"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding TotalRevenue, StringFormat='${0:N0}'}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource SuccessColor}"
                                           HorizontalOptions="End"/>
                                </Grid>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Expenses Section -->
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Expenses" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource DangerColor}"/>

                            <CollectionView ItemsSource="{Binding PLExpenses}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10,8" 
                                                Margin="0,0,0,2"
                                                Background="{DynamicResource HeaderBackgroundColor}">
                                            <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                                <Label Grid.Column="0" 
                                                       Text="{Binding Description}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource PrimaryTextColor}"/>
                                                <Label Grid.Column="1" 
                                                       Text="{Binding Amount, StringFormat='${0:N0}'}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource DangerColor}"
                                                       HorizontalOptions="End"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- Total Expenses -->
                            <Border Padding="15,10" 
                                    Background="{DynamicResource HeaderBackgroundColor}">
                                <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                    <Label Grid.Column="0" 
                                           Text="Total Expenses"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding TotalExpenses, StringFormat='${0:N0}'}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource DangerColor}"
                                           HorizontalOptions="End"/>
                                </Grid>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Net Profit -->
                        <Border Padding="15,10" 
                                Background="{DynamicResource PrimaryColor}"
                                StrokeShape="RoundRectangle 8">
                            <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                <Label Grid.Column="0" 
                                       Text="Net Profit"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource PrimaryTextColor}"/>
                                <Label Grid.Column="1" 
                                       Text="{Binding NetProfit, StringFormat='${0:N0}'}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{Binding NetProfitColor}"
                                       HorizontalOptions="End"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Balance Sheet -->
                <Border Background="{DynamicResource CardBackgroundColor}"
                        Padding="20"
                        StrokeShape="RoundRectangle 10"
                        IsVisible="{Binding ShowBalanceSheet}">
                    <VerticalStackLayout Spacing="15">
                        <HorizontalStackLayout>
                            <Label Text="Balance Sheet" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                            <Label Text="{Binding BalanceSheetDate, StringFormat='As of {0:MMM dd, yyyy}'}" 
                                   BackgroundColor="{DynamicResource PrimaryColor}"
                                   TextColor="White"
                                   Padding="10,5"
                                   Margin="10,0,0,0"/>

                        </HorizontalStackLayout>

                        <!-- Assets -->
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Assets" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource SuccessColor}"/>

                            <CollectionView ItemsSource="{Binding Assets}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10,8" 
                                                Margin="0,0,0,2"
                                                Background="{DynamicResource HeaderBackgroundColor}">
                                            <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                                <Label Grid.Column="0" 
                                                       Text="{Binding Description}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource PrimaryTextColor}"/>
                                                <Label Grid.Column="1" 
                                                       Text="{Binding Amount, StringFormat='${0:N0}'}"
                                                       FontSize="14"
                                                       TextColor="{DynamicResource SuccessColor}"
                                                       HorizontalOptions="End"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- Total Assets -->
                            <Border Padding="15,10" 
                                    Background="{DynamicResource HeaderBackgroundColor}">
                                <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                    <Label Grid.Column="0" 
                                           Text="Total Assets"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding TotalAssets, StringFormat='${0:N0}'}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource SuccessColor}"
                                           HorizontalOptions="End"/>
                                </Grid>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Liabilities & Equity -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                            <!-- Liabilities -->
                            <VerticalStackLayout Grid.Column="0" Spacing="10">
                                <Label Text="Liabilities" 
                                       FontSize="16" 
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource DangerColor}"/>

                                <CollectionView ItemsSource="{Binding Liabilities}" HeightRequest="150">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="10,8" 
                                                    Margin="0,0,0,2"
                                                    Background="{DynamicResource HeaderBackgroundColor}">
                                                <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                                    <Label Grid.Column="0" 
                                                           Text="{Binding Description}"
                                                           FontSize="14"
                                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                                    <Label Grid.Column="1" 
                                                           Text="{Binding Amount, StringFormat='${0:N0}'}"
                                                           FontSize="14"
                                                           TextColor="{DynamicResource DangerColor}"
                                                           HorizontalOptions="End"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>

                            <!-- Equity -->
                            <VerticalStackLayout Grid.Column="1" Spacing="10">
                                <Label Text="Equity" 
                                       FontSize="16" 
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource PrimaryColor}"/>

                                <CollectionView ItemsSource="{Binding EquityItems}" HeightRequest="150">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="10,8" 
                                                    Margin="0,0,0,2"
                                                    Background="{DynamicResource HeaderBackgroundColor}">
                                                <Grid ColumnDefinitions="*,100" ColumnSpacing="10">
                                                    <Label Grid.Column="0" 
                                                           Text="{Binding Description}"
                                                           FontSize="14"
                                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                                    <Label Grid.Column="1" 
                                                           Text="{Binding Amount, StringFormat='${0:N0}'}"
                                                           FontSize="14"
                                                           TextColor="{DynamicResource PrimaryColor}"
                                                           HorizontalOptions="End"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Balance Check -->
                        <Border Padding="15,10" 
                                Background="{Binding IsBalanced, Converter={StaticResource BalanceColorConverter}}"
                                StrokeShape="RoundRectangle 8">
                            <Grid ColumnDefinitions="*,100,100" ColumnSpacing="10">
                                <Label Grid.Column="0" 
                                       Text="Assets = Liabilities + Equity"
                                       FontSize="15"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label Grid.Column="1" 
                                       Text="{Binding TotalAssets, StringFormat='${0:N0}'}"
                                       FontSize="15"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label Grid.Column="2" 
                                       Text="{Binding TotalLiabilitiesEquity, StringFormat='${0:N0}'}"
                                       FontSize="15"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Financial Ratios -->
                <Border Background="{DynamicResource CardBackgroundColor}"
                        Padding="20"
                        StrokeShape="RoundRectangle 10">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Financial Ratios" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{DynamicResource PrimaryTextColor}"/>

                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15" RowDefinitions="Auto,Auto" RowSpacing="15">
                            <!-- Profit Margin -->
                            <Border Grid.Column="0" Grid.Row="0" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Profit Margin" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding ProfitMargin, StringFormat='{0:P1}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource SuccessColor}"/>
                                    <Label Text="{Binding ProfitMarginStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- ROE -->
                            <Border Grid.Column="1" Grid.Row="0" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Return on Equity" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding ReturnOnEquity, StringFormat='{0:P1}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryColor}"/>
                                    <Label Text="{Binding ROEStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Debt to Equity -->
                            <Border Grid.Column="2" Grid.Row="0" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Debt to Equity" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding DebtToEquity, StringFormat='{0:F2}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource DangerColor}"/>
                                    <Label Text="{Binding DebtToEquityStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Current Ratio -->
                            <Border Grid.Column="0" Grid.Row="1" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Current Ratio" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding CurrentRatio, StringFormat='{0:F2}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource InfoColor}"/>
                                    <Label Text="{Binding CurrentRatioStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Asset Turnover -->
                            <Border Grid.Column="1" Grid.Row="1" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Asset Turnover" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding AssetTurnover, StringFormat='{0:F2}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource AccentColor}"/>
                                    <Label Text="{Binding AssetTurnoverStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Quick Ratio -->
                            <Border Grid.Column="2" Grid.Row="1" 
                                    Background="{DynamicResource HeaderBackgroundColor}"
                                    Padding="15"
                                    StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                    <Label Text="Quick Ratio" 
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Text="{Binding QuickRatio, StringFormat='{0:F2}'}" 
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource WarningColor}"/>
                                    <Label Text="{Binding QuickRatioStatus}" 
                                           FontSize="11"
                                           TextColor="{DynamicResource TertiaryTextColor}"/>
                                </VerticalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Statements Actions -->
        <Border Grid.Row="2" 
                Background="{DynamicResource HeaderBackgroundColor}"
                Padding="15">
            <Grid ColumnDefinitions="*,Auto">
                <HorizontalStackLayout Grid.Column="0" Spacing="15">
                    <Button Text="ðŸ“Š Generate Statement" 
                            BackgroundColor="{DynamicResource PrimaryColor}"
                            TextColor="White"
                            Padding="15,10"
                            CornerRadius="8"
                            Command="{Binding GenerateStatementCommand}"/>

                    <Button Text="ðŸ“ˆ Compare Periods" 
                            BackgroundColor="{DynamicResource CardBackgroundColor}"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            Padding="15,10"
                            CornerRadius="8"
                            Command="{Binding ComparePeriodsCommand}"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="1" Spacing="10">
                    <Button Text="ðŸ‘ï¸ Audit Trail" 
                            BackgroundColor="{DynamicResource CardBackgroundColor}"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            Padding="15,10"
                            CornerRadius="8"
                            Command="{Binding AuditTrailCommand}"/>

                    <Button Text="ðŸ“¥ Export All" 
                            BackgroundColor="{DynamicResource SuccessColor}"
                            TextColor="White"
                            Padding="15,10"
                            CornerRadius="8"
                            Command="{Binding ExportAllCommand}"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>

    </Grid>

</ContentPage>